{% extends "base.html" %}
{% block content %}
<div class="row">
    <div class="span12">
        <h1>Timetable</h1>
        <ul class="taglist">
            {% for tag in tags %}
            {% if tag.is_category %}
            <li>{{ tag.html }}</li>
            {% endif %}
            {% endfor %}
        </ul>
    </div>
</div>
{% for d, d_ in table.items %}
<div class="row timetable">
    <div class="span12">
        <h2>{{ d }}</h2>
        <table class="table table-bordered">
            <colgroup>
                <col width="*">
                {% for r in rooms %}
                <col width="14%">
                {% endfor %}
            </colgroup>
            <thead>
                <th></th>
                {% for r in rooms %}
                <th>{{ r.name }}</th>
                {% endfor %}
            </thead>
            <tbody>
                {% for t, t_ in d_.items %}
                <tr>
                    <th>{{ t.begin|date:"H:i" }}</th>
                    {% for r, s in t_.items %}
                    {% if s %}
                    <td class="booked {% if s.is_keynote %}keynote{% endif %}"
                        rowspan="{{ s.times.all|length }}"
                        onclick="document.location='{% url "session" s.id %}'">
                        <div class="session {{ s.get_classes|join:' ' }}"
                            rel="tooltip" data-html="true" data-original-title="{{ s.html_get_category_tags }}">
                            <table class="tagbar" cellspacing="1" cellpadding="0"><tr>
                                {% for tag in s.tags.all %}
                                {% if tag.is_category %}
                                <td class="tag-{{ tag.uid }}"></td>
                                {% endif %}
                                {% endfor %}
                            </tr></table>
                            <a href="{% url "session" s.id %}">
                                <p class="title">{{ s.name }}</p>
                            </a>
                            {% if s.speakers %}
                            <div class="speaker_and_company">
                                <div class="speaker">
                                    {% for speaker in s.speakers.all %}
                                    <a href="{% url "speaker" speaker.id %}">{{ speaker.name }}</a>
                                    {% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </div>
                                <div class="company">
                                    {% for company in s.get_companies %}
                                    <a href="{% url "company" company.id %}">{{ company.name }}</a>
                                    {% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </td>
                    {% else %}
                    <td></td>
                    {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endfor %}
{% endblock %}
{% block script %}
<script type="text/javascript">
$(function () {
    $("[rel='tooltip']").tooltip();
    $(".taglist .tag").click(function() {
        if( $(this).hasClass("highlight") )
        {
            $(".session").show();
            $(".taglist .tag").removeClass("muted highlight");
        }
        else
        {
            $(".session-"+this.id).show();
            $(".session").not(".session-"+this.id).hide();

            $(this).removeClass("muted").addClass("highlight");
            $(".taglist .tag").not("#"+this.id).addClass("muted").removeClass("highlight");
        }
    });
});
</script>
{% endblock %}
